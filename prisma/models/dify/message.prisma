model DifyMessage {
    id             Int    @id @default(autoincrement())
    conversationId String @map("conversation_id") @db.VarChar(255)
    messageId      String @unique @map("message_id") @db.VarChar(255)
    userId         String @map("user_id") @db.VarChar(100)

    // 消息类型: query(用户问题) 或 answer(AI回答)
    type        MessageType
    // 消息内容类型: text(文本)、image(图片)、file(文件)、audio(音频)、video(视频)等
    contentType MessageContentType @default(TEXT) @map("content_type")
    content     String             @db.Text

    // 关联的父消息ID(用于追踪问答对)
    parentMessageId String? @map("parent_message_id") @db.VarChar(255)

    // 额外信息
    metadata Json?
    tokens   Int? // token消耗
    latency  Int? // 响应延迟(ms)

    // 审计字段
    deleted   Boolean   @default(false)
    createdAt DateTime  @default(now()) @map("created_at")
    createdBy String?   @map("created_by") @db.VarChar(100)
    updatedAt DateTime  @updatedAt @map("updated_at")
    updatedBy String?   @map("updated_by") @db.VarChar(100)
    deletedAt DateTime? @map("deleted_at")
    deletedBy String?   @map("deleted_by") @db.VarChar(100)

    @@index([conversationId])
    @@index([userId])
    @@index([messageId])
    @@index([createdAt])
    @@index([parentMessageId])
    @@index([contentType])
    @@map("dify_messages")
}

enum MessageType {
    QUERY // 用户问题
    ANSWER // AI回答
}

enum MessageContentType {
    TEXT // 文本消息
    IMAGE // 图片
    FILE // 文件
    AUDIO // 音频
    VIDEO // 视频
    MARKDOWN // Markdown格式
    CODE // 代码
    JSON // JSON数据
    MIXED // 混合类型(包含多种格式)
}
