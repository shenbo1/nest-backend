model DifyMessage {
    id             Int    @id @default(autoincrement())
    conversationId String @map("conversation_id") @db.VarChar(255)
    messageId      String @unique @map("message_id") @db.VarChar(255)
    userId         String @map("user_id") @db.VarChar(100)

    // 消息角色: user(用户) 或 assistant(助手) 或 system(系统)
    role        MessageRole
    // 消息内容类型: text(文本)、image(图片)、card(卡片)、recommend(推荐)、file(文件)
    contentType MessageContentType @default(TEXT) @map("content_type")
    content     String             @db.Text

    // 关联的父消息ID(用于追踪问答对)
    parentMessageId String? @map("parent_message_id") @db.VarChar(255)

    // 额外信息
    metadata Json?
    tokens   Int? // token消耗
    latency  Int? // 响应延迟(ms)

    // 审计字段
    deleted   Boolean   @default(false)
    createdAt DateTime  @default(now()) @map("created_at")
    createdBy String?   @map("created_by") @db.VarChar(100)
    updatedAt DateTime  @updatedAt @map("updated_at")
    updatedBy String?   @map("updated_by") @db.VarChar(100)
    deletedAt DateTime? @map("deleted_at")
    deletedBy String?   @map("deleted_by") @db.VarChar(100)

    @@index([conversationId])
    @@index([userId])
    @@index([messageId])
    @@index([createdAt])
    @@index([parentMessageId])
    @@index([contentType])
    @@map("dify_messages")
}

enum MessageRole {
    USER // 用户
    ASSISTANT // 助手
    SYSTEM // 系统
}

enum MessageContentType {
    TEXT // 文本消息
    IMAGE // 图片
    CARD // 卡片
    RECOMMEND // 推荐
    FILE // 文件
}
